sudo: false

language: java

jdk: openjdk8

before_install:
- openssl aes-256-cbc -K $encrypted_62b1a583e357_key -iv $encrypted_62b1a583e357_iv
  -in resources/travis_copy_artifacts_rsa.enc -out /tmp/travis_copy_artifacts_rsa
  -d
- eval "$(ssh-agent -s)"
- chmod 600 /tmp/travis_copy_artifacts_rsa
- ssh-add /tmp/travis_copy_artifacts_rsa
- echo -e "Host ${DEPLOY_HOST}\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config

script:
- mvn clean install -Pdependencies,openwis,admin -Pjacoco-coverage -q
- mvn clean install -Puser -Pjacoco-coverage -q
- mvn sonar:sonar -Popenwis,admin,user -Dsonar.organization=${SONAR_ORGANIZATION} -Dsonar.projectKey=${SONAR_PROJECT_KEY} -Dsonar.host.url=${SONAR_URL} -Dsonar.login=${SONAR_KEY} -q

after_success: tar acf openwis_artifacts.tar.gz openwis-dataservice/openwis-dataservice-server/openwis-dataservice-server-ear/target/openwis-dataservice.ear
  openwis-dataservice/openwis-dataservice-config/target/openwis-dataservice-config-files.zip
  openwis-harness/openwis-harness-client/target/openwis-harness-client.jar openwis-securityservice/openwis-securityservice-war/target/openwis-securityservice.war
  openwis-metadataportal/openwis-portal/openwis-user-portal/openwis-user-portal-user.war
  openwis-metadataportal/openwis-portal/openwis-admin-portal/openwis-admin-portal-admin.war
  openwis-metadataportal/openwis-portal-solr/target/openwis-portal-solr.war openwis-stagingpost/target/stagingPost.war
  openwis-management/openwis-management-service/openwis-management-service-ear/target/openwis-management-service.ear

deploy:
  provider: script
  skip-cleanup: true
  script: rsync -r --quiet --delete-after ${TRAVIS_BUILD_DIR}/openwis_artifacts.tar.gz
    ${DEPLOY_USER}@${DEPLOY_HOST}:${DEPLOY_DIRECTORY}
  on:
    branch: cicd_integration

notifications:
  email:
    recipients:
    - openwis-travis@meteo.fr
    on_success: change
    on_failure: change

env:
  global:
  - secure: HMhlfrn9UmSd5IPND82xlWrCYMQz/lga20JHO7nSPFT+qOdApNSdfPecG2MEMS7Ry8n8NOfNth6kNjaB4y7KVb9d3UPSBIbs6+whhPUWG6NXDCjQcUAAaMdxzTF60h3sg6x4BnnJUwaUKiOYWtRITivRJ2OD/uN3LPg1e5Mnwdh+MvDU1rR00k3UAuO+2uxziZjFsha0NTAXj/GoJput7g7+p3vbNPdsohSP94Tj3pjOOk7UKHNpfh8JYePKBWQDjwpkivY5dL8xUYzybkFqdY/cVQGEKFoD3tNEynvRqTSs4onEvH7qH1caU4vLJNluI1uJ9vDsZs0PpZT+hGF0UAIKdB0S+Xkhfk67qxRHa8mzMKCqW1SQDtKqCCcF8pNbgdh73An4sGhmbhA9SU7r5kf8LZ1tytSaZ3JwB6lGBFlygFV7biv+Su0PR13lFSB4hMMC9EOicoT1VFFAdMePD9DrzKvWpxtJQFXvAAPDkNV76SOE+V5fNtLXaYuIhTPbJ20lqRh6GuapcxymuhLgFy7gbmTGZ9Q54h+KCahlZ1UWY+ZhGmbCHgBueC10J4cDL7l8LakLRmJEZ3Eu63a2rBqtcoeCGlPXLOJQP4TNvh/s7eGC4DtkOP1xNVoQS/QGpPAcGYpRg6WqQBpW93hKJjSfcW4baUm6t7CPyUzw2RQ=
  - secure: YMlqqbP1fc3+LxnyCOWy3j4I6FQrecIO5uUtbXMSOx/2dJB8MqelLhpMUawbRDGo36OY+bjKB7QnzakczBBhkG1zahp8r7fKcPyDmlzRRrj8GHDpXtrzq+yAqIHYuAOp7zadU97UKmteT5AvT+hRL3UQElAWLVMIgOTvO7w5GV6KHbrkisb6+utxgALtUWOzTJlMJi8SnVaNfEeFP3QN3iZR2mZDFWDJqcdsgJVL5nZe0Dk1+70TW/pDP/aLnXrtENrbTahC2s1jzJHGJbcOSQtsK7nUwUJePLxbdReCiyBoup0NLghzl2un2yDbX6wdjdXfi3kye2jXv6SyOzwnuCfStv9P0SZIwzfJGBswaa+4bMH0CkYBq7GjOZSNkVdH2GUxxbezICzp16O3qWYll7zieAM24HwH1c+eeP7xJd6lyhKWeIwKMdbpHnXukfm863EJoTPjD15uv6dqiamWDAAMG7b4rHhZ79qyeHNT4RLXGc61oPnGfQSsgVhr6W2A61J1lAori33dEgqWikLrPEvWLQsS68UzqJ0RKWi5X4CBn0VVyXRLQOZ5O1tzLk6HRTzeSTj4D3NUV01i6r0NS9XhchkFQ8S8nGxcOEmUPXyf1dFQ1RTQK3m6UGIfCRV2a1Q8IZ4cv4ggurMzXpqx9DZdb424/22UkfesFFbjpV8=
  - secure: OZYV39+d6D8kLtk2WzXCHg4cJO70BDezgI8JxSFK2c5M0djiArfmDLsZJrMI8HFV2Sow1ByT7+FHSD73r/bQbuF7QOxI7TnoNgYCfgUL+nXi9f5upQXDMT7udhi0OI4qOu+1tVRe1FO9loMG5q24XJNghsQxd8KfK7IeIoG+XvIKQAQYPsMNj4cX6Y2Z7vOWOtP3d3JKHzqer6wsDj/SpO4tWI9Y5az9iO1XR2jMtroPnGRRrL7R1UqAplecJCk0Cs/kCeer5WnTXtJ+bPUwv9b8gvuT0rP2RFFNmfdmd7Fr/HoY5yHlZ6LvcM/scFijHWiGbViPIaSn0IAEU/pU5DshanJ4DfxsjR8GDQFnqZms28H6X5/N+WMu3lFTMnEWPM2ZX91kzJcAQ6uJ7Y+DXCyFfxhDfRw9q5MsZHeaAPx+3vVMclGNTHdlEvbSRZkKaJP892eH8Ys5xqdmCTAtpYVWWPd9FrxEBYeBE1nCqERhZ419VbORq7gEHMApNHqp7T1xDuCYmu+n+XYpzc/DcQMIh7LyQ6uEvUzOKPgDXu/3K5ww0MG0wSVKVpc94LoFszEya5jD8+wvBWoGg9GIwBxzRhjVUEjNZV/wngzvbVQ9u6GidTXud22YHkeWMEELhL8R9U0BsEqAqps2LQqXvmsBDyJ4L8mAI4ynpga2cWk=
  - secure: WgoM0GdsZ23nYkab53OZYn88gkRTjfhXUGzABLn/uLv6fNl4ngJ6sK9aRf9ii1uzh6/AmrJiRbJnkxCVPHX1YVD/0uSE083fBapuuABm7CKneALcjB+RzQNSlPY/Cjbf+t1exge8w1FIcMX5WWwwwICk4ZfULYjbu51bj51lr03KSGc67af+A+bsx9qQzQ+c9pquYwgRTSlba+2AlVmf55x5vUsGcqPR5L9GemJJqNGQvmj2VN/M8aj3JzZV/vQqTW3iNdPrS2f1n/m0NDalr6yFSdEz9/ryjPb6pimFnQLXpAnsjb57+bWDp4vKaND1uElweC8HdHBv26FUz+8l4ye/IdiJYZvfC+TuZyACqd2bI3OGaZPD22GmILzPAw7R7RfEHvWAl7gq1CLZwPLtTpPaJvvnboBiXJDus9ERUJ8udJzMVaw207fQ50QJVNFIcNfnG4C2QFbjq3DLS+33SoXnTHRVYA0OZpLakfJB0Jl4jnD5n3Q9Tr6W/ZOlP9CzZCmnSv3YKuniYI0qUwoOD0l3XR/rlwn4K4+8Apmj12Z2w1PbDTGfNHXKQyy4PWNbQoX0VD9PPkRWeywhFg5Ra5qxbAxqrBIYXTSIR/+p5cvqQPVEPO0MdmSQkTMyMf+W5yHXVIvxxnfuGNg9cEA34IT1v+k6BzeIxjefz21VXG8=
  - secure: Esv0ioW+QPmvte8TJ48AMqFY+F03l8FEIa+qD01kabK3fvIbLG7HJB2GY3dxO5V3mT+MyaqZt/UIZOFQR1ArARkv7wne+NtjeLOvZ8l5AiQxQUkA6BcgJpFZIksOn+l3eHrHBApXKTb9MZgpqJbstlO4lsYjNGkN29XtySFbjYIfitssYom8SoJWEfLE+lTFWDMWo3+3V5w+6Jmgh4GREZVh2/2eWWa1DRhDq6La5Fvn2mChQvz9sQ8u9/TT81mJysC7n+gc1IugCUigy33pZi+Mw/zAcm8EEv0iGDqxheyAwLFLwad0LjzpZXbYMrx8Lph1JLDAhFAU4jIyv9W0UYVX52D2g2PMYjMIG2pU2lXRXQBC0p/0IHACiE/bIXUMeoqFqASt/LRyLzRIyfGzokKQwAqn7qjyzmJknDvDZOKIhh7BEsF3IovGZaVFQEW1LuAY10/sVhZBynCYE/o31fCshxotfbfv0VQBxbnErirxXw2Ej1YUjbiR4cIKkFQxZT0t2yZsQ91kMkBCEzaD+nm6WPRO1YNpjkGX2vL4og9yxEm35Cf9zNwmp5nLikZ8g6gVgZ6rGOxhQHSgI9eMfiO2PCL4jT78bGPpm8nCQMc2HtYRIAEH8c7osFwmwnmy/ywCr1IRfjGmysrr2TBubkALlZxiHw1pDADMAQ8eOZA=
  - secure: Vhf4mozyOli5aF2v72k19jwMijaxeez39aJBeMQW86A3lGgvzPRvOCOSJBmH8rZR1AbEaZf0FQsRsXnvFfDGk928aTpQjXXzUR2km54lFzlCbFWOvSP4cVvUu8LI7mh4wO/necbWcPAB+5nEJ1kMsHziUbCClTuo7Fchqs44kRdn/AyPYan0Rl35lVEwbTn9V6QXxVb1xfp29D26U4DlCNU3kpZlFKFJ8DQXxbyjdOssQy46HtrZoNAruRGM6wicTPbTw9em3hJu2+VCbEPa4hWgl+nQOnw7ET+B3bu2kQ4aismonNHPJBAXHnN0kpsUMLAtrz4fFSxjeKc/AFNBNvrdMppUm3hsodz1IvYf+bOuOZZT+25F3GG3RoFwMQ2MnhwIMB8BvP1yWkaYgqGOLIQwzVmGRX6O5wTvieivfgyGN3x189Ib0WsN57PHTYDIPC/nPUmhH3whRYUZeLVjguQc7wNL1Z9ZJT4Vr0bVO4K30iBjbQ+ziEf31IIW7GfFpCAL7Yc3xqyL6FluB2YBItbXZjDqLhkVuHYFRqO2wLstrXjjDtdMSfs+bGQmYJQRHRyzhwdhPZUFUDmS89S1DIezvAwB+vrtOnNb9BX30r24jEqdbu20ltpWwxl4vzdGNFEf1DO2XD/bEtvs8m0yRbRc4bj/3+POvwS+VC4Gx1E=
  - secure: PgEOatBBP9PE3mww0+9ndx++BTzKdGjdp6u8QiDvhOXZQ6oAP8i3boRNEkTLKebDJXzs+vq0BhHWNAFmINWnlTw+tTCJsbmWzTFLbr6v2jRF9ruW+7i2VassktnWcZe45uhxvrH/y0CQOrXu1+5aTVj4lVCIG3gaU+HwrhwLnuSBTXnqeJAgAhZz01XqbwAGTnO+E29IhEDoimWQrLT+DrNALBiCLsCCDTetV2DJiATt0q6T56eSjJrz5EZyWjXFXCHcyczfs1TRfsAFxzUjCGdaB0NrXpQvohH+W+CFLCGbhjfLdSh6ABbp4Y2x5ID/Vfgbq7qwgmoucd/QiLFTAkbeL8TcDUxfQ6v4FXkCeC1aWL29V2Sb0T2FhlYuD3foCvOfNHvYEYtZ0STjp9yyrJqGG6L5VIrFaEIxwtuIlh8Vsxe40MShS3klWpmQ7oIxMpCL+BCu0LOgNEVg8Q+DH0I+yJIC3c0GnxQrGjd189xJNU9JvNDNuhdiXubv2oMrha+30M6mywMNMCa3tS0vXZkrCC7ufSk4XdhIoBsQn1y7fAcb+wwogfdK1vhqBDt0IZ35ZffO7Klkyx0OUxw9ur8BfhzrUERCWCkh0xGotAcgu8QA9vITnjl06P74khHY9pQKH68V/WkYD4kysxHY78jQoxz/WH5S6CKJE31k+qs=
